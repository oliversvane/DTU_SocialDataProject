<head>
    <meta charset="UTF-8">
    <title>Social Data Science 2022</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Standard favicon -->
    <link rel="icon" type="image/png" href="{{ url_for('static', filename='favicon.ico') }}">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css?family=Roboto:400,500,700,900" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.9/css/all.css" integrity="sha384-5SOiIsAziJl6AWe0HWRKTXlfcSHKmYV4RBF18PPJ173Kzn7jzMyFuTtk8JA7QQG1" crossorigin="anonymous">
    <!-- Main CSS -->
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/style.css')}}">
    <!-- Bokeh -->
    <script type="text/javascript" src="https://cdn.bokeh.org/bokeh/release/bokeh-2.4.2.min.js"></script>
    <script type="text/javascript" src="https://cdn.bokeh.org/bokeh/release/bokeh-gl-2.4.2.min.js"></script>
    <script type="text/javascript" src="https://cdn.bokeh.org/bokeh/release/bokeh-widgets-2.4.2.min.js"></script>
    <script type="text/javascript" src="https://cdn.bokeh.org/bokeh/release/bokeh-tables-2.4.2.min.js"></script>
    <script type="text/javascript" src="https://cdn.bokeh.org/bokeh/release/bokeh-mathjax-2.4.2.min.js"></script>
    <script type="text/javascript">
        Bokeh.set_log_level("info");
    </script>
    <!-- Main JS -->
    <script type = "text/javascript" src="{{ url_for('static', filename='js/main.js')}}"></script>


</head>
<main>
    <header>
        <div>
            <h1>Header</h1>
        </div>
    </header>

    <article>
        <aside>
            <div class="menu">
                <h3><a href="#intro">Introduction </a></h3>
                <h3><a href="#deep">Data Deep Dive & Analysis </a></h3>
                <h3><a href="#deep">Explore On Your Own</a></h3>
                
            </div>
        </aside>
        <section>
            <div class="content">
                <h2 id = "intro">Introduction</h2>
                <p>Since the industrial revolution the global economy has grown dramtically. The rise in income have lifted millions out of poverty, and given them the means to buy what they desire in their life. However, it has been fueled by an increasing population and rate of unprecedented comsumption. The rising demand, use of fossil fuels has resulted in dramatic levels of polution, decreased biodiversity, reduced air quality etc. We as a race consumes more natural resources by August, than the earth can regenrate every year. If we want to keep of standard of living high, and not keep abusing the earths resources while slowly frying it, we need to optimize how we use and recycle resources. <a href="https://phys.org/news/2018-07-humans-depleting-earth-resources-footprint.html">1 - phys.org/</a></p>
                <p>Denmark has one of the highest rates of CO2 emissions per capita, we emit 53 million tons of CO2 alone from burning coal, oil and gas, which are partially used for heating and electricty generation. Roughly 15% of the danes emission comes from the production of electricty which primarliy are used in their houses for freezers, lighting etc.  26% of the danes emissions comes from the production of heating, which are used houses, water etc. It is clear that a reduction in the energi consumption of our houses, would greatly contribute to reducing Denmarks overall emission impact. But how do you know wether you have a &quot;Green&quot; house? <a href="https://www.okolariet.dk/viden-om/klima/ideer-til-skolen-klima/inspirationsmateriale-niveau-2/co2-i-hjemmet">2 - okolariet.dk</a></p>
                <p>In Denmark Energy-labels were introduced in 2010. The energy-labels is in short a document that describes the condition of a building im terms of energy consumption. The Energy-labels lets potential buys of a house know how energy-econmic the house is, what the yearly consumption and price of water, heating and electricty but also let a potential buyer know how much it would cost to renovate the house to make it even more energy efficient.</p>
                <p>In this website we will investigate how the buildings in Region Hovedstaden compare to eachother, in terms of materials, energy-labels, municipalities &amp; the wealth of it. A machine learning model will also be created to see if we can predict what energy-labels a house based on the materials and other attributes of the building.<a href="https://www.nettopower.dk/nyheder/energimaerkning">3 - nettopower.dk</a></p>
                
                <div class="viz" id="viz1">
                    <select id="viz1_x" onchange="viz1()" class="form-select">
                        <option>connectionToSewage</option>
                    </select>
                    <select id="viz1_l" onchange="viz1()" class="form-select">
                        <option>currentUse</option>
                        <option>HeatSupply</option>
                    </select>
                    <div id="viz1_container" style="max-height: 600px;"> <img style="display:block; margin:auto;" src="{{ url_for('static', filename='images/loading.gif')}}" alt="loading"></div>
                </div>

                <h2 id = "deep">Data Deep Dive & Analysis</h2>
                <div class="viz" id="viz2">
                    <select id="viz2_x" onchange="viz2()" class="form-select">
                        <option>YearOfConstruction</option>
                    </select>
                    <label for="viz2_bins">Bins (1-200):</label>
                    <input id="viz2_bins" type="number" name="quantity" min="1" max="200" onchange="viz2()" value="60"> 
                    <div id="viz2_container" style="max-height: 600px;"> <img style="display:block; margin:auto;" src="{{ url_for('static', filename='images/loading.gif')}}" alt="loading"></div>
                </div>



                <div class="viz" id="viz3">
                    <div id="viz3_container" style="max-height: 600px;">
                        <iframe class="map", src="{{ url_for('static', filename='html/viz3.html')}}"></iframe>
                    </div>
                </div>
                

                <div class="viz" id="viz4" style="display: inline;">

                    <select class="clselect" id="viz4_x" onchange="viz4()" name="test" multiple>
                        <option class="cloption">A</option>
                        <option class="cloption">B</option>
                        <option class="cloption">C</option>
                        <option class="cloption">D</option>
                        <option class="cloption">E</option>
                        <option class="cloption">F</option>
                        <option class="cloption">G</option>
                    </select>
                    <div id="viz4_container" style="max-height: 600px;"> <img style="display:block; margin:auto;" src="{{ url_for('static', filename='images/loading.gif')}}" alt="loading"></div>
                </div>


                <div class="viz" id="viz5">
                    <div id="viz5_container" style="max-height: 600px;"> <img style="display:block; margin:auto;" src="{{ url_for('static', filename='images/loading.gif')}}" alt="loading"></div>
                </div>

                <div class="viz" id="viz7">
                    <div id="viz7_container" style="max-height: 600px;"> <img style="display:block; margin:auto;" src="{{ url_for('static', filename='images/loading.gif')}}" alt="loading"></div>
                </div>

                <div class="viz" id="model">
                    <form action="javascript:get_pred()">
                    <div class="input_label">
                        <select id="model_1" class="form-select"></select>
                    </div>
                    <div class="input_label">
                        <select id="model_2" class="form-select"></select>
                    </div>
                    <div class="input_label">
                        <select id="model_3" class="form-select"></select>
                    </div>
                    <div class="input_label">
                        <select id="model_4" class="form-select"></select>
                    </div>
                    <div class="input_label">
                        <select id="model_5" class="form-select"></select>
                    </div>
                    <div class="input_label">
                        <select id="model_6" class="form-select"></select>
                    </div>
                    <div class="input_label">
                        <select id="model_7" class="form-select"></select>
                    </div>

                    <div class="input_label">
                        <label>Year of renovation</label>
                        <input id="model_8" type="number" name="yearR" min="1" max="2022" value="2000">
                    </div>
                    <div class="input_label">
                        <label>Housing area (sqm.)</label>
                        <input id="model_9" type="number" name="m2" min="1" max="9999" value="250">
                    </div>
                    <div class="input_label">
                        <label>Year of construction</label>
                        <input id="model_10" type="number" name="yearC" min="1" max="2022" value="2000">
                    </div>
                    


                    
                    <input type="submit" value="Submit">
                    </form>
                    <div id="predCon"></div>
                </div>
            </div>
        </section>
    </article>

    <footer>

    <script>


        function get_unique(name) {
                var urlX = encodeURI("/api/unique?name="+name);
                var xmlHttp = new XMLHttpRequest();
                
                xmlHttp.open("GET", urlX , false);
                xmlHttp.send(null);
                
                var object = JSON.parse(xmlHttp.response);
                
                const array = [];
                for(var i in object) {
                    array.push([i,object[i]][1]);
                }
                return array
        }

        function get_pred(){
            const array = [];
            for (let i = 0; i < 10; i++) {
                    idX = "model_" + (i+1) ;
                    var container = document.getElementById(idX);
                    final = container.value
                    array.push([i,final]);
                }
            var urlX = encodeURI("/model/predict?input="+array);

            var xmlHttp = new XMLHttpRequest();
            
            xmlHttp.open("GET", urlX , false);
            xmlHttp.send(null);
            
            var finalX = document.getElementById("predCon")
            finalX.innerHTML = xmlHttp.response;
        }
    </script>
    <script>
        function viz1()
            {
                x_c_list = document.getElementById("viz1_x").value
                l_c_list = document.getElementById("viz1_l").value
                

                var container = document.getElementById("viz1_container");
                var img = document.createElement("img"); 
                img.src = "{{ url_for('static', filename='images/loading.gif')}}";
                img.style = "display:block; margin:auto;"
                container.innerHTML = "";
                container.appendChild(img);
                var urlX = "/viz/viz1?x_c="+x_c_list+"&l_c="+l_c_list;
                
                fetch(urlX).then(function(response) { return response.json(); }).then(function(item) {
                    var container = document.getElementById("viz1_container").innerHTML = "";
                    return Bokeh.embed.embed_item(item, "viz1_container"); })

            }

            function viz2()
            {
                x_c_list = document.getElementById("viz2_x").value
                bins = document.getElementById("viz2_bins").value
                

                var container = document.getElementById("viz2_container");
                var img = document.createElement("img"); 
                img.src = "{{ url_for('static', filename='images/loading.gif')}}";
                img.style = "display:block; margin:auto;"
                container.innerHTML = "";
                container.appendChild(img);
                var urlX = "/viz/viz2?x_c="+x_c_list+"&bins="+bins;
                
                fetch(urlX).then(function(response) { return response.json(); }).then(function(item) {
                    var container = document.getElementById("viz2_container").innerHTML = "";
                    return Bokeh.embed.embed_item(item, "viz2_container"); })

            }


            function viz4()
            {
                
                options  = document.getElementById("viz4_x").selectedOptions
                document.getElementById("viz4_x").disabled = true;
                var values = Array.from(options).map(({ value }) => value);
                var x = values.join('');

                var container = document.getElementById("viz4_container");
                var img = document.createElement("img"); 
                img.src = "{{ url_for('static', filename='images/loading.gif')}}";
                img.style = "display:block; margin:auto;"
                container.innerHTML = "";
                container.appendChild(img);

                var urlX = "/viz/viz4?x_c="+x;
                var xmlHttp = new XMLHttpRequest();
                
                
                xmlHttp.open("GET", urlX , false);
                xmlHttp.send(null);
                    
                container.innerHTML = xmlHttp.responseText;
                document.getElementById("viz4_x").disabled = false;

            }

            function viz5()
            {
                var container = document.getElementById("viz5_container");
                var urlX = "/viz/viz5";
                
                fetch(urlX).then(function(response) { return response.json(); }).then(function(item) {
                    var container = document.getElementById("viz5_container").innerHTML = "";
                    return Bokeh.embed.embed_item(item, "viz5_container"); })
            }


            function viz7()
            {
                var container = document.getElementById("viz7_container");
                var urlX = "/viz/viz7";
                
                fetch(urlX).then(function(response) { return response.json(); }).then(function(item) {
                    var container = document.getElementById("viz7_container").innerHTML = "";
                    return Bokeh.embed.embed_item(item, "viz7_container"); })
            }


            function create_model(){
                x = ['Sewage connection', 
                    'Water Connection',
                    'Current use',
                    'Heat Supply',
                    'Material of roof',
                    'Material of wall',
                    'Kommune'
                    ]


                for (let i = 0; i < x.length; i++) {
                    idX = "model_" + (i+1) ;
                    var unique = get_unique(x[i])
                    var container = document.getElementById(idX);
                    const labels = document.createElement('label');
                    labels.innerHTML = x[i]
                    container.parentNode.insertBefore(labels, container);
                    container.name = x[i];
                    for (let j = 0; j < unique.length; j++) {
                        var option = document.createElement('option');
                        option.value = x[i]+"_"+unique[j];
                        option.innerHTML = unique[j];
                        container.appendChild(option);
                    } 
                } 
            }
            create_model()

    </script>

    </footer>
</main>
